// ==UserScript==
// @name         jstris-game-instance-hook
// @namespace    http://tampermonkey.net/
// @version      1.1
// @description  jstris（v1.40.1）において、Gameクラスのインスタンスを外部からアクセスできるようにWindowオブジェクト（window.GameInstance）に登録します。
// @author       chokotia
// @match        https://jstris.jezevec10.com/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=jezevec10.com
// @grant        none
// @run-at       document-start
// ==/UserScript==

(function () {
    'use strict';

    const obfuscatedCode = `var _0x22e82f=_0x4457;function _0x1111(){var _0x512dc7=['closeRoomDialog','Hoge','tooltip','more_adv','attackMode','openSettings','5UeHPgN','joinRoom','initGamePad','innerHTML','472ywelvP','slotSettings','lobby','redraw','more-practice','length','onChatScroll','disabled','webGL','toggle','vol-control','okIc','16302920xIpKxo','click','data','skins','res','removeEventListener','grs','vsfxSelect','zoomIc','switchRDmode','onPresetChange','bind','createRoomButton','makeRoomWrapper','gamepadconnected','joinLimits','none','getElementById','loadSkin','suspended','loadGhostSkin','ghost','WebAudioPlugin','addEventListener','keydown','chatExpand','pop','display','hasSolid','init','Enable\x20webGL\x20before\x20using\x20loadVideoSkin!','sendChat','changeSFX','GameInstance','slots','saveRD','onfocus','classList','slotSettingsBtn','blur','sfxSelect','cancelCreation','create','showMore','focusState','scroll','250lfRdQa','refreshLobbby','Live','onchange','skinOverride','statsSlots','call','27876BQbPMN','onclick','more_simple','chatInput','setFocusState','forEach','browserTabFocusChange','gridForm','style','state','modal-opened','play','ghostEnabled','Error\x20while\x20trying\x20to\x20resume\x20the\x20Web\x20Audio\x20context.','split','refreshLobby','resume','keyInput3','changeSkin','7073LrKhgo','updateGhostPiece','createRoom','gamepaddisconnected','setGrid','moreClose','sendRestartEvent','error','hqSlots','12945501HSXczi','forceExtended','global','saveDataClose','context','input','cursor','toggleLobbby','6080HwagIY','saveLimits','loadVideoSkin','value','checked','Settings','start','zoomControl','fsSlots','sitout','autoScale','634974xnVzwF','slotStats','2964pAUgex','customPre','nullpoDAS','keyup','settings','hideResults','editRoomButton','chatBox','8043UyOrAo','toggleMore','showRoomDialog','6349OAtMcX','addJL','useCustomPreset','[data-toggle=\x22tooltip\x22]','lobbyBox','NAME','gif','main'];_0x1111=function(){return _0x512dc7;};return _0x1111();}(function(_0x456bbb,_0x328b9e){var _0x2ce1ae=_0x4457,_0x599a60=_0x456bbb();while(!![]){try{var _0x42b257=-parseInt(_0x2ce1ae(0x15f))/0x1*(-parseInt(_0x2ce1ae(0x11f))/0x2)+-parseInt(_0x2ce1ae(0x157))/0x3*(-parseInt(_0x2ce1ae(0x14a))/0x4)+-parseInt(_0x2ce1ae(0x170))/0x5*(parseInt(_0x2ce1ae(0x155))/0x6)+parseInt(_0x2ce1ae(0x162))/0x7*(parseInt(_0x2ce1ae(0x174))/0x8)+-parseInt(_0x2ce1ae(0x142))/0x9+-parseInt(_0x2ce1ae(0x180))/0xa+-parseInt(_0x2ce1ae(0x139))/0xb*(-parseInt(_0x2ce1ae(0x126))/0xc);if(_0x42b257===_0x328b9e)break;else _0x599a60['push'](_0x599a60['shift']());}catch(_0xfe5c2d){_0x599a60['push'](_0x599a60['shift']());}}}(_0x1111,0xd6cd3));function MyOnLoad(){var _0x1869a8=_0x4457;_0x2c374e=new Game(),window[_0x1869a8(0x112)]=_0x2c374e,window[_0x1869a8(0x16b)]=_0x1869a8(0x16b),_0x2c374e[_0x1869a8(0x150)](),settingsTabs[_0x1869a8(0x10e)](),document['addEventListener'](_0x1869a8(0x109),_0x2c374e['keyInput2'][_0x1869a8(0x18b)](_0x2c374e),![]),document['addEventListener'](_0x1869a8(0x15a),_0x2c374e[_0x1869a8(0x137)][_0x1869a8(0x18b)](_0x2c374e),![]),document[_0x1869a8(0x102)](_0x1869a8(0x169))[_0x1869a8(0x108)](_0x1869a8(0x181),function(){var _0x231fa1=_0x1869a8;_0x2c374e[_0x231fa1(0x12a)](0x0);},!![]),document['getElementById'](_0x1869a8(0x13b))[_0x1869a8(0x108)]('click',function(){var _0x3084b4=_0x1869a8;_0x2c374e[_0x3084b4(0x12a)](0x1);},!![]),document[_0x1869a8(0x102)]('settingsBox')[_0x1869a8(0x108)](_0x1869a8(0x181),function(){var _0x325445=_0x1869a8;_0x2c374e[_0x325445(0x12a)](0x1);},!![]),document[_0x1869a8(0x102)](_0x1869a8(0x15e))[_0x1869a8(0x108)](_0x1869a8(0x181),function(){var _0x5e2d5d=_0x1869a8;_0x2c374e[_0x5e2d5d(0x12a)](0x1);},!![]),document[_0x1869a8(0x102)]('chatBox')['addEventListener'](_0x1869a8(0x11e),_0x2c374e[_0x1869a8(0x121)][_0x1869a8(0x17a)]['bind'](_0x2c374e[_0x1869a8(0x121)]),!![]),document[_0x1869a8(0x102)](_0x1869a8(0x166))[_0x1869a8(0x108)](_0x1869a8(0x181),function(){var _0x1a0606=_0x1869a8;_0x2c374e[_0x1a0606(0x12a)](0x1);},!![]),document['getElementById'](_0x1869a8(0x11c))[_0x1869a8(0x127)]=_0x2c374e[_0x1869a8(0x121)][_0x1869a8(0x160)][_0x1869a8(0x18b)](_0x2c374e[_0x1869a8(0x121)]),document[_0x1869a8(0x102)](_0x1869a8(0x13e))[_0x1869a8(0x127)]=_0x2c374e[_0x1869a8(0x121)][_0x1869a8(0x160)][_0x1869a8(0x18b)](_0x2c374e[_0x1869a8(0x121)]),document[_0x1869a8(0x102)](_0x1869a8(0x11a))['onclick']=_0x2c374e['Live'][_0x1869a8(0x16a)][_0x1869a8(0x18b)](_0x2c374e[_0x1869a8(0x121)]),document[_0x1869a8(0x102)](_0x1869a8(0x18c))[_0x1869a8(0x127)]=_0x2c374e['Live'][_0x1869a8(0x161)][_0x1869a8(0x18b)](_0x2c374e[_0x1869a8(0x121)]),document['getElementById'](_0x1869a8(0x15d))[_0x1869a8(0x127)]=_0x2c374e[_0x1869a8(0x121)]['showRoomDialogForEdit'][_0x1869a8(0x18b)](_0x2c374e[_0x1869a8(0x121)]),document[_0x1869a8(0x102)](_0x1869a8(0x176))[_0x1869a8(0x127)]=_0x2c374e[_0x1869a8(0x121)][_0x1869a8(0x149)][_0x1869a8(0x18b)](_0x2c374e['Live']),document[_0x1869a8(0x102)](_0x1869a8(0x135))['onclick']=_0x2c374e['Live'][_0x1869a8(0x120)]['bind'](_0x2c374e[_0x1869a8(0x121)]),document['getElementById'](_0x1869a8(0x15b))[_0x1869a8(0x127)]=function(){var _0x481941=_0x1869a8;_0x2c374e[_0x481941(0x14f)][_0x481941(0x16f)](),_0x2c374e[_0x481941(0x12a)](0x1);},document[_0x1869a8(0x102)](_0x1869a8(0x184))[_0x1869a8(0x127)]=_0x2c374e[_0x1869a8(0x121)][_0x1869a8(0x13f)][_0x1869a8(0x18b)](_0x2c374e[_0x1869a8(0x121)]),document[_0x1869a8(0x102)]('closeLobby')[_0x1869a8(0x127)]=_0x2c374e[_0x1869a8(0x121)][_0x1869a8(0x149)][_0x1869a8(0x18b)](_0x2c374e[_0x1869a8(0x121)]),document[_0x1869a8(0x102)]('closeLink')[_0x1869a8(0x127)]=_0x2c374e[_0x1869a8(0x121)][_0x1869a8(0x15c)][_0x1869a8(0x18b)](_0x2c374e[_0x1869a8(0x121)]),document[_0x1869a8(0x102)](_0x1869a8(0x11b))[_0x1869a8(0x127)]=_0x2c374e[_0x1869a8(0x121)][_0x1869a8(0x18d)]['bind'](_0x2c374e[_0x1869a8(0x121)]),document['getElementById']('sendMsg')[_0x1869a8(0x127)]=_0x2c374e['Live'][_0x1869a8(0x110)][_0x1869a8(0x18b)](_0x2c374e[_0x1869a8(0x121)]),document[_0x1869a8(0x102)]('myCanvas')[_0x1869a8(0x127)]=function(){var _0x394d7c=_0x1869a8;!_0x2c374e['Live'][_0x394d7c(0x153)]&&_0x2c374e[_0x394d7c(0x11d)]&&_0x2c374e[_0x394d7c(0x177)](),_0x2c374e[_0x394d7c(0x12a)](0x0);},document['getElementById'](_0x1869a8(0x129))[_0x1869a8(0x127)]=function(){var _0xa28a61=_0x1869a8;_0x2c374e[_0xa28a61(0x12a)](0x1);},document[_0x1869a8(0x102)](_0x1869a8(0x129))[_0x1869a8(0x115)]=function(){var _0x5f078d=_0x1869a8;_0x2c374e[_0x5f078d(0x12a)](0x1);},document[_0x1869a8(0x102)]('chatInput')[_0x1869a8(0x108)](_0x1869a8(0x109),function(_0x20fad8){var _0x19979f=_0x1869a8;0xd===_0x20fad8['keyCode']&&_0x2c374e[_0x19979f(0x121)][_0x19979f(0x110)]();}),document[_0x1869a8(0x102)](_0x1869a8(0x178))[_0x1869a8(0x127)]=_0x2c374e['Live']['toggleMorePractice']['bind'](_0x2c374e['Live'],![]),document[_0x1869a8(0x102)](_0x1869a8(0x10d))[_0x1869a8(0x127)]=function(){var _0x3fd3ac=_0x1869a8;document['getElementById']('solid')[_0x3fd3ac(0x17b)]=!document[_0x3fd3ac(0x102)]('hasSolid')[_0x3fd3ac(0x14e)];},document['getElementById'](_0x1869a8(0x106))['onclick']=function(){var _0x48aa81=_0x1869a8;_0x2c374e['ghostEnabled']=document[_0x48aa81(0x102)](_0x48aa81(0x106))[_0x48aa81(0x14e)],_0x2c374e[_0x48aa81(0x131)]&&_0x2c374e[_0x48aa81(0x132)]&&(_0x2c374e[_0x48aa81(0x13a)](),_0x2c374e[_0x48aa81(0x177)]());},document[_0x1869a8(0x102)](_0x1869a8(0x128))[_0x1869a8(0x127)]=function(){var _0x21905f=_0x1869a8;_0x2c374e[_0x21905f(0x121)]['switchRDmode'](0x0);},document[_0x1869a8(0x102)](_0x1869a8(0x16d))[_0x1869a8(0x127)]=function(){var _0x4a59fc=_0x1869a8;_0x2c374e[_0x4a59fc(0x121)][_0x4a59fc(0x189)](0x1);},document['getElementById']('more_preset')[_0x1869a8(0x127)]=function(){_0x2c374e['Live']['switchRDmode'](0x2);},document['getElementById'](_0x1869a8(0x114))['onclick']=function(){var _0x54ac56=_0x1869a8;_0x2c374e[_0x54ac56(0x121)]['saveRD']();},document[_0x1869a8(0x102)](_0x1869a8(0x145))[_0x1869a8(0x127)]=function(){var _0x5c313e=_0x1869a8;this['parentElement'][_0x5c313e(0x12e)][_0x5c313e(0x10c)]=_0x5c313e(0x101);},document[_0x1869a8(0x102)](_0x1869a8(0x163))[_0x1869a8(0x127)]=function(){var _0xb388ef=_0x1869a8;showElem(document[_0xb388ef(0x102)](_0xb388ef(0x100)));},document['getElementById'](_0x1869a8(0x14b))[_0x1869a8(0x127)]=function(){var _0x5bc629=_0x1869a8;hideElem(document[_0x5bc629(0x102)]('joinLimits'));},document['getElementById'](_0x1869a8(0x16e))['onchange']=function(){var _0x105215=_0x1869a8;_0x2c374e[_0x105215(0x121)]['attackSelect']();},document[_0x1869a8(0x102)]('presetSel')[_0x1869a8(0x122)]=function(){var _0x13c81c=_0x1869a8;_0x2c374e[_0x13c81c(0x121)][_0x13c81c(0x18a)]();},document[_0x1869a8(0x102)](_0x1869a8(0x158))[_0x1869a8(0x127)]=function(){var _0xb296dd=_0x1869a8;_0x2c374e[_0xb296dd(0x121)][_0xb296dd(0x164)]();},document[_0x1869a8(0x102)](_0x1869a8(0x159))[_0x1869a8(0x127)]=_0x2c374e[_0x1869a8(0x14f)][_0x1869a8(0x159)][_0x1869a8(0x18b)](_0x2c374e[_0x1869a8(0x14f)]),document[_0x1869a8(0x102)](_0x1869a8(0x119))[_0x1869a8(0x122)]=soundCredits,document[_0x1869a8(0x102)](_0x1869a8(0x187))[_0x1869a8(0x122)]=soundCredits,document[_0x1869a8(0x102)](_0x1869a8(0x10a))['onclick']=_0x2c374e['GS']['chatExpand'][_0x1869a8(0x18b)](_0x2c374e['GS']),window[_0x1869a8(0x108)](_0x1869a8(0x118),function(){_0x2c374e['browserTabFocusChange'](0x0);},![]),window[_0x1869a8(0x108)]('focus',function(){var _0x448c29=_0x1869a8;_0x2c374e[_0x448c29(0x12c)](0x1);},![]),window[_0x1869a8(0x108)](_0x1869a8(0x18e),_0x2c374e[_0x1869a8(0x14f)][_0x1869a8(0x172)][_0x1869a8(0x18b)](_0x2c374e[_0x1869a8(0x14f)])),window[_0x1869a8(0x108)](_0x1869a8(0x13c),_0x2c374e[_0x1869a8(0x14f)]['removeGamePad'][_0x1869a8(0x18b)](_0x2c374e[_0x1869a8(0x14f)])),document['getElementById'](_0x1869a8(0x17e))['addEventListener'](_0x1869a8(0x147),function(){var _0x5dc40a=_0x1869a8;_0x2c374e[_0x5dc40a(0x14f)]['volumeChange'](this[_0x5dc40a(0x14d)]);}),document[_0x1869a8(0x102)](_0x1869a8(0x117))[_0x1869a8(0x108)]('click',function(){var _0x1e1557=_0x1869a8,_0x4ae6d8=document[_0x1e1557(0x102)](_0x1e1557(0x117)),_0x2a3082=document[_0x1e1557(0x102)](_0x1e1557(0x175));_0x4ae6d8[_0x1e1557(0x116)][_0x1e1557(0x17d)](_0x1e1557(0x188)),_0x4ae6d8[_0x1e1557(0x116)][_0x1e1557(0x17d)](_0x1e1557(0x17f)),toggleElem(_0x2a3082);},![]),document[_0x1869a8(0x102)](_0x1869a8(0x175))[_0x1869a8(0x108)](_0x1869a8(0x181),function(_0xe39f1a){_0xe39f1a['stopImmediatePropagation']();},![]),document['getElementById'](_0x1869a8(0x151))[_0x1869a8(0x122)]=function(){var _0x11fd2e=_0x1869a8,_0x3d56c7=parseInt(document['getElementById'](_0x11fd2e(0x151))[_0x11fd2e(0x14d)]);document['getElementById']('zoomNow')[_0x11fd2e(0x173)]=_0x3d56c7+'%',_0x2c374e['GS']['setZoom'][_0x11fd2e(0x125)](_0x2c374e['GS'],_0x3d56c7);},document[_0x1869a8(0x102)]('fsSlots')[_0x1869a8(0x127)]=function(){var _0x4acd3b=_0x1869a8;_0x2c374e['GS']['fullScreen'][_0x4acd3b(0x125)](_0x2c374e['GS'],document['getElementById'](_0x4acd3b(0x152))[_0x4acd3b(0x14e)]);},document[_0x1869a8(0x102)](_0x1869a8(0x141))[_0x1869a8(0x127)]=function(){var _0x362ce4=_0x1869a8;_0x2c374e['GS'][_0x362ce4(0x143)]=document['getElementById'](_0x362ce4(0x141))[_0x362ce4(0x14e)],_0x2c374e['GS'][_0x362ce4(0x154)][_0x362ce4(0x125)](_0x2c374e['GS']);},document[_0x1869a8(0x102)](_0x1869a8(0x124))[_0x1869a8(0x127)]=function(){var _0x4aca81=_0x1869a8;_0x2c374e['GS'][_0x4aca81(0x156)]=document[_0x4aca81(0x102)]('statsSlots')[_0x4aca81(0x14e)],_0x2c374e['GS'][_0x4aca81(0x154)][_0x4aca81(0x125)](_0x2c374e['GS']);},window[_0x1869a8(0x171)]=_0x1ed124,window[_0x1869a8(0x103)]=_0x45350f,window[_0x1869a8(0x14c)]=_0xeed56,window[_0x1869a8(0x105)]=_0x2c374e[_0x1869a8(0x105)]['bind'](_0x2c374e),window['loadSFX']=_0x235ce8;for(var _0x3f6f1b=0x0;_0x3f6f1b<document[_0x1869a8(0x12d)][_0x1869a8(0x186)][_0x1869a8(0x179)];_0x3f6f1b++){document['gridForm'][_0x1869a8(0x186)][_0x3f6f1b]['onclick']=function(){var _0x2aecfa=_0x1869a8;_0x2c374e[_0x2aecfa(0x14f)][_0x2aecfa(0x13d)](parseInt(this['value']));};}var _0x355d72=function(){var _0x22d20b=_0x1869a8;try{createjs[_0x22d20b(0x107)]['context']&&_0x22d20b(0x104)===createjs[_0x22d20b(0x107)][_0x22d20b(0x146)][_0x22d20b(0x12f)]&&(createjs['WebAudioPlugin'][_0x22d20b(0x146)][_0x22d20b(0x136)](),window[_0x22d20b(0x185)](_0x22d20b(0x181),_0x355d72));}catch(_0x4f2609){console['error'](_0x22d20b(0x133)),console[_0x22d20b(0x140)](_0x4f2609);}};window['addEventListener'](_0x1869a8(0x181),_0x355d72);var _0x22f1db,_0x37a29c=![],_0x4d3f40=document[_0x1869a8(0x102)](_0x1869a8(0x169));function _0x4370cf(){var _0xff046b=_0x1869a8;_0x4d3f40['style'][_0xff046b(0x148)]=_0xff046b(0x101),_0x37a29c=!![],setTimeout(function(){_0x37a29c=![];},0x64);}_0x4d3f40[_0x1869a8(0x108)]('mousemove',function(){var _0x58f2e3=_0x1869a8;_0x37a29c||(_0x37a29c=![],clearTimeout(_0x22f1db),_0x4d3f40['style'][_0x58f2e3(0x148)]=null,_0x22f1db=setTimeout(_0x4370cf,0xbb8));});};var _0x2c374e=void 0x0;function _0x45350f(_0xcce4c8,_0x118d5f,_0x161dde){var _0x1cb92f=_0x4457;_0x2c374e[_0x1cb92f(0x183)][0x1][_0x1cb92f(0x182)]=_0xcce4c8,_0x2c374e[_0x1cb92f(0x183)][0x1]['w']=_0x118d5f,_0x2c374e[_0x1cb92f(0x183)][0x1]['cdn']=![],_0x2c374e['changeSkin'](0x1),_0x161dde&&_0x161dde[_0x1cb92f(0x144)]&&(_0x2c374e['GS'][_0x1cb92f(0x123)]=_0x2c374e['skins'][0x1],_0x2c374e['GS'][_0x1cb92f(0x113)][_0x1cb92f(0x12b)](function(_0x100b05){var _0x14a57c=_0x1cb92f;_0x100b05['v'][_0x14a57c(0x138)](0x1);}));}function _0xeed56(_0x5dc402,_0x4b49e0){var _0x27e95c=_0x4457;_0x4b49e0=_0x4b49e0||{},_0x27e95c(0x17c)===_0x2c374e['v'][_0x27e95c(0x167)]?_0x27e95c(0x168)!==_0x5dc402[_0x27e95c(0x134)]('.')[_0x27e95c(0x10b)]()?_0x2c374e['v']['setupVideo'](_0x5dc402,_0x4b49e0):_0x2c374e['v']['setupGif'](_0x5dc402,_0x4b49e0):alert(_0x27e95c(0x10f));}function _0x235ce8(_0x39be91,_0x36e15){var _0x56629e=_0x4457;_0x2c374e[_0x56629e(0x111)](_0x39be91,_0x36e15);}function _0x1ed124(_0x37b6dc){var _0x2dd656=_0x4457;_0x2c374e['Live'][_0x2dd656(0x171)](_0x37b6dc);}function _0x4457(_0x2c2960,_0x116038){var _0x11111d=_0x1111();return _0x4457=function(_0x445783,_0x2dec0f){_0x445783=_0x445783-0x100;var _0x835c8a=_0x11111d[_0x445783];return _0x835c8a;},_0x4457(_0x2c2960,_0x116038);}'function'==typeof $&&($(_0x22e82f(0x165))[_0x22e82f(0x16c)]({'viewport':{'selector':'body','padding':-0x2710}}),$(window)['on'](_0x22e82f(0x130),()=>{var _0x3456c7=_0x22e82f;_0x2c374e[_0x3456c7(0x12a)](0x1);}));`
    window.eval(obfuscatedCode);

    function setup() {
        // 既存 onload を無効化
        Object.defineProperty(window, 'onload', {
            configurable: true,
            enumerable: true,
            get: function () {
                return null;
            },
            set: function (fn) {
                console.log('Tampermonkey: window.onload 無効化');
            }
        });

        // 自前の onload を使う
        window.addEventListener('load', MyOnLoad);
    }

    function main() {
        if (typeof window.MyOnLoad !== 'function') {
            console.log('Tampermonkey: MyOnLoad is not defined, skipping.');
            return;
        }
        setup();
    }

    main();

})();
